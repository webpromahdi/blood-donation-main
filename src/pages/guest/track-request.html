<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Track Request - BloodConnect</title>
    <link rel="stylesheet" href="/src/styles/styles.css" />
  </head>
  <body class="min-h-screen bg-gray-50">
    <div class="max-w-4xl mx-auto px-6 py-8">
      <a
        href="/"
        class="inline-flex items-center justify-center px-4 py-2 mb-6 border border-red-600 text-red-600 hover:bg-red-50 rounded-lg font-medium transition-colors"
      >
        <i data-lucide="arrow-left" class="size-4 mr-2"></i>
        Back to Home
      </a>

      <div class="space-y-6">
        <div>
          <h1 class="text-3xl font-bold text-red-600 mb-2">
            Track Your Blood Request
          </h1>
          <p class="text-gray-600">
            Enter your phone number or request ID to check status
          </p>
        </div>

        <!-- Search Form -->
        <div class="p-6 bg-white border border-gray-200 rounded-xl">
          <form id="trackForm" class="flex gap-3">
            <input
              type="text"
              id="searchInput"
              placeholder="Enter Phone Number or Request ID"
              class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
            <button
              type="submit"
              class="inline-flex items-center justify-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors"
            >
              <i data-lucide="search" class="size-5 mr-2"></i>
              Search
            </button>
          </form>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden space-y-4">
          <h2 class="text-xl font-semibold text-gray-900">Search Results</h2>
          <div id="resultsContainer"></div>
        </div>

        <!-- No Results Message -->
        <div
          id="noResults"
          class="hidden p-8 bg-white border border-gray-200 rounded-xl text-center"
        >
          <i
            data-lucide="search-x"
            class="size-16 text-gray-300 mx-auto mb-4"
          ></i>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">
            No Results Found
          </h3>
          <p class="text-gray-600">
            We couldn't find any blood requests matching your search. Please
            check your request ID or phone number and try again.
          </p>
        </div>

        <!-- Sample Data Info -->
        <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <p class="text-blue-800 text-sm">
            <strong>Demo:</strong> Try searching for REQ001, REQ003, 555-1234,
            or 555-5678 to see sample results.
          </p>
        </div>
      </div>
    </div>

    <script type="module" src="/src/scripts/main.js"></script>
    <script>
      // Sample data for demo purposes
      const mockRequests = [
        {
          id: "REQ001",
          patientName: "John Doe",
          bloodType: "O+",
          quantity: "2 Units",
          status: "Processing",
          urgency: "Emergency",
          hospital: "City Hospital",
          phone: "555-1234",
          requestDate: "2024-01-05",
          timeline: [
            {
              status: "Submitted",
              date: "2024-01-05 10:30 AM",
              completed: true,
            },
            {
              status: "Verified",
              date: "2024-01-05 11:00 AM",
              completed: true,
            },
            {
              status: "Donor Matched",
              date: "2024-01-05 02:00 PM",
              completed: true,
            },
            { status: "Donation Complete", date: "Pending", completed: false },
            { status: "Delivered", date: "Pending", completed: false },
          ],
        },
        {
          id: "REQ003",
          patientName: "Mike Johnson",
          bloodType: "B-",
          quantity: "1 Unit",
          status: "Pending",
          urgency: "Normal",
          hospital: "St. Mary's Hospital",
          phone: "555-5678",
          requestDate: "2024-01-06",
          timeline: [
            {
              status: "Submitted",
              date: "2024-01-06 09:00 AM",
              completed: true,
            },
            {
              status: "Verified",
              date: "2024-01-06 10:30 AM",
              completed: true,
            },
            { status: "Donor Matched", date: "Pending", completed: false },
            { status: "Donation Complete", date: "Pending", completed: false },
            { status: "Delivered", date: "Pending", completed: false },
          ],
        },
      ];

      // Get query param on page load
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get("query");
        if (query) {
          document.getElementById("searchInput").value = query;
          performSearch(query);
        }
      });

      document.getElementById("trackForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const query = document.getElementById("searchInput").value.trim();
        if (query) {
          performSearch(query);
        }
      });

      function performSearch(query) {
        const results = mockRequests.filter(
          (req) =>
            req.id.toLowerCase().includes(query.toLowerCase()) ||
            req.phone.includes(query)
        );

        const resultsSection = document.getElementById("resultsSection");
        const noResults = document.getElementById("noResults");
        const container = document.getElementById("resultsContainer");

        if (results.length > 0) {
          resultsSection.classList.remove("hidden");
          noResults.classList.add("hidden");
          container.innerHTML = results
            .map((req) => createRequestCard(req))
            .join("");
          if (window.initIcons) window.initIcons();
        } else {
          resultsSection.classList.add("hidden");
          noResults.classList.remove("hidden");
        }
      }

      function createRequestCard(req) {
        const urgencyBadge =
          req.urgency === "Emergency"
            ? '<span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded-full"><i data-lucide="alert-circle" class="size-3 mr-1"></i>Emergency</span>'
            : '<span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-full">Normal</span>';

        const statusColor =
          req.status === "Processing"
            ? "text-blue-600 border-blue-600"
            : req.status === "Pending"
            ? "text-yellow-600 border-yellow-600"
            : "text-green-600 border-green-600";

        const timelineHtml = req.timeline
          .map(
            (step, index) => `
        <div class="flex items-start gap-3">
          <div class="flex flex-col items-center">
            <div class="size-8 rounded-full flex items-center justify-center ${
              step.completed
                ? "bg-green-100 text-green-600"
                : "bg-gray-100 text-gray-400"
            }">
              ${
                step.completed
                  ? '<i data-lucide="check" class="size-4"></i>'
                  : '<i data-lucide="circle" class="size-4"></i>'
              }
            </div>
            ${
              index < req.timeline.length - 1
                ? '<div class="w-0.5 h-8 bg-gray-200"></div>'
                : ""
            }
          </div>
          <div class="pb-4">
            <p class="font-medium ${
              step.completed ? "text-gray-900" : "text-gray-500"
            }">${step.status}</p>
            <p class="text-sm text-gray-500">${step.date}</p>
          </div>
        </div>
      `
          )
          .join("");

        return `
        <div class="p-6 bg-white border border-gray-200 rounded-xl">
          <div class="flex items-start justify-between mb-4">
            <div>
              <div class="flex items-center gap-2 mb-1">
                <h3 class="text-lg font-semibold text-gray-900">${req.id}</h3>
                ${urgencyBadge}
              </div>
              <p class="text-gray-600">Patient: ${req.patientName}</p>
            </div>
            <span class="px-3 py-1 text-sm font-medium border rounded-full ${statusColor}">${req.status}</span>
          </div>

          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
            <div>
              <p class="text-sm text-gray-500">Blood Type</p>
              <p class="font-semibold text-red-600">${req.bloodType}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Quantity</p>
              <p class="font-semibold text-gray-900">${req.quantity}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Hospital</p>
              <p class="font-semibold text-gray-900">${req.hospital}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Request Date</p>
              <p class="font-semibold text-gray-900">${req.requestDate}</p>
            </div>
          </div>

          <div>
            <h4 class="font-semibold text-gray-900 mb-4">Request Timeline</h4>
            <div class="ml-2">
              ${timelineHtml}
            </div>
          </div>
        </div>
      `;
      }
    </script>
  </body>
</html>


